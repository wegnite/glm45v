# AI Universal Generator - 项目分析与 AI Agent 提示词指南

## 一、项目概述

### 项目基本信息
- **项目名称**: AI Universal Generator (基于 ShipAny Template)
- **版本**: 2.6.0
- **技术栈**: Next.js 15.2 + TypeScript + Tailwind CSS + Drizzle ORM
- **架构模式**: App Router (Next.js 14+) + Server Components
- **主要功能**: AI 内容生成平台，支持多种 AI 模型和生成类型

### 核心特性
1. **多 AI 提供商集成**: OpenAI、DeepSeek、OpenRouter、SiliconFlow、Replicate、Kling
2. **多语言支持**: 中英文国际化 (i18n)
3. **认证系统**: NextAuth + Google/GitHub OAuth
4. **支付集成**: Creem/Stripe 双支付系统
5. **数据库**: Supabase PostgreSQL + Drizzle ORM
6. **存储**: Cloudflare R2 对象存储
7. **UI 框架**: Radix UI + Tailwind CSS + Framer Motion

## 二、项目结构详解

### 目录结构
```
ai-shipany-v2.6.0-ai_model/
├── src/                      # 源代码目录
│   ├── app/                  # Next.js App Router
│   │   ├── [locale]/        # 国际化路由
│   │   │   ├── (default)/   # 默认布局页面
│   │   │   ├── (console)/   # 控制台页面
│   │   │   └── (landing)/   # 着陆页
│   │   └── api/             # API 路由
│   │       ├── auth/        # 认证相关
│   │       ├── demo/        # AI 生成演示
│   │       ├── pay/         # 支付回调
│   │       └── checkout/    # 结账流程
│   ├── aisdk/               # AI SDK 集成
│   │   ├── deepseek/        # DeepSeek 提供商
│   │   ├── openrouter/      # OpenRouter 提供商
│   │   ├── replicate/       # Replicate 提供商
│   │   └── siliconflow/     # SiliconFlow 提供商
│   ├── auth/                # 认证模块
│   ├── components/          # React 组件
│   │   ├── blocks/          # 业务组件块
│   │   │   └── ai-generator/ # AI 生成器核心组件
│   │   ├── common/          # 通用组件
│   │   ├── forms/           # 表单组件
│   │   ├── layouts/         # 布局组件
│   │   └── ui/              # UI 基础组件
│   ├── config/              # 配置文件
│   ├── db/                  # 数据库
│   │   ├── schema.ts        # 数据库模式定义
│   │   ├── migrations/      # 数据库迁移
│   │   └── config.ts        # Drizzle 配置
│   ├── hooks/               # React Hooks
│   ├── i18n/                # 国际化
│   │   ├── messages/        # 翻译文件
│   │   └── pages/           # 页面内容
│   ├── lib/                 # 工具库
│   ├── models/              # 数据模型
│   ├── services/            # 业务服务
│   │   ├── ai/              # AI 服务
│   │   ├── auth/            # 认证服务
│   │   ├── payment/         # 支付服务
│   │   └── storage/         # 存储服务
│   └── types/               # TypeScript 类型定义
├── public/                  # 静态资源
├── test/                    # 测试文件
│   └── integration/         # 集成测试
├── docs/                    # 文档目录
├── .env.example            # 环境变量模板
├── .env.development.example # 开发环境模板
├── .env.production.example  # 生产环境模板
├── CLAUDE.md               # Claude Code 配置
├── next.config.js          # Next.js 配置
├── tailwind.config.ts      # Tailwind 配置
├── tsconfig.json           # TypeScript 配置
└── package.json            # 项目依赖

```

### 数据库结构

主要数据表：
1. **users** - 用户信息表
2. **accounts** - OAuth 账户关联
3. **sessions** - 用户会话
4. **orders** - 订单记录
5. **invites** - 邀请码系统
6. **feedback** - 用户反馈
7. **api_keys** - API 密钥管理
8. **generation_logs** - AI 生成日志

### API 端点

#### 核心 API
- `/api/demo/gen-text` - 文本生成
- `/api/demo/gen-stream-text` - 流式文本生成  
- `/api/demo/gen-image` - 图像生成
- `/api/auth/[...nextauth]` - NextAuth 认证
- `/api/checkout` - 创建支付会话
- `/api/pay/notify/*` - 支付回调处理
- `/api/get-user-info` - 获取用户信息
- `/api/get-user-credits` - 获取用户积分

## 三、AI Agent 提示词模板

### 1. 功能开发 Agent

```markdown
你是一个专业的 Next.js 全栈开发工程师，正在开发一个 AI 内容生成平台。

项目技术栈：
- Frontend: Next.js 15.2 (App Router) + TypeScript + Tailwind CSS
- Backend: Next.js API Routes + Drizzle ORM
- Database: Supabase PostgreSQL
- Auth: NextAuth (Google/GitHub OAuth)
- AI: OpenAI, DeepSeek, OpenRouter 等多个提供商
- Payment: Creem/Stripe

任务要求：
1. 遵循 Next.js 14+ App Router 最佳实践
2. 使用 Server Components 优先，Client Components 仅在必要时使用
3. 所有新代码必须使用 TypeScript 并确保类型安全
4. 遵循项目现有的代码风格和结构
5. 新功能必须支持国际化 (i18n)
6. 确保代码通过 ESLint 检查

文件位置规范：
- 测试文件放在 /test 目录
- 文档放在 /docs 目录
- 不要在项目根目录创建文件

请实现：[具体功能描述]
```

### 2. AI 集成 Agent

```markdown
你是一个 AI 集成专家，负责在项目中集成新的 AI 提供商。

当前项目已集成的 AI 提供商：
- OpenAI (GPT-4, DALL-E)
- DeepSeek
- OpenRouter
- SiliconFlow
- Replicate
- Kling

集成要求：
1. 在 /src/aisdk/ 下创建新提供商目录
2. 实现标准化的 Provider 接口
3. 支持文本生成和图像生成（如果提供商支持）
4. 实现错误处理和重试机制
5. 添加到 /src/services/ai/ 的统一调用接口
6. 在 AI Generator 组件中添加新选项
7. 更新环境变量模板文件

文件结构示例：
/src/aisdk/[provider]/
├── index.ts          # 主入口
├── types.ts          # 类型定义
├── text-generator.ts # 文本生成
└── image-generator.ts # 图像生成

请集成：[AI 提供商名称]
```

### 3. UI/UX 改进 Agent

```markdown
你是一个精通现代 Web UI 的前端开发专家。

项目 UI 技术栈：
- Radix UI 组件库
- Tailwind CSS 样式
- Framer Motion 动画
- Lucide React 图标
- 响应式设计

设计原则：
1. 保持界面简洁、现代、专业
2. 确保所有交互都有合适的反馈
3. 支持深色/浅色主题切换
4. 移动端优先的响应式设计
5. 遵循 WCAG 2.1 无障碍标准

组件位置：
- 基础 UI 组件：/src/components/ui/
- 业务组件：/src/components/blocks/
- 布局组件：/src/components/layouts/
- 表单组件：/src/components/forms/

请改进：[具体 UI 需求]
```

### 4. 数据库优化 Agent

```markdown
你是一个数据库优化专家，熟悉 PostgreSQL 和 Drizzle ORM。

项目数据库配置：
- Database: Supabase PostgreSQL
- ORM: Drizzle
- Schema: /src/db/schema.ts
- Migrations: /src/db/migrations/

优化要求：
1. 确保所有查询都有适当的索引
2. 使用 Drizzle 的类型安全查询
3. 实现适当的数据验证
4. 考虑并发和事务处理
5. 优化查询性能

数据库操作命令：
- npm run db:generate  # 生成迁移
- npm run db:migrate   # 执行迁移
- npm run db:studio    # 打开数据库管理界面
- npm run db:push      # 推送 schema 变更

请优化：[具体数据库需求]
```

### 5. 测试编写 Agent

```markdown
你是一个测试专家，负责编写全面的测试用例。

测试要求：
1. 所有测试文件必须放在 /test 目录
2. 集成测试放在 /test/integration/
3. 单元测试放在 /test/unit/
4. 使用项目现有的测试框架
5. 覆盖正常流程和边界情况
6. 包含错误处理测试

测试命令：
- npm run test           # 运行所有测试
- npm run test:integration # 运行集成测试

测试重点：
- AI 生成功能的各种场景
- API 端点的响应和错误处理
- 认证流程
- 支付流程
- 数据验证

请为 [功能名称] 编写测试
```

### 6. 性能优化 Agent

```markdown
你是一个性能优化专家，精通 Next.js 优化技术。

优化目标：
1. 首屏加载时间 < 2秒
2. Lighthouse 分数 > 90
3. 减少客户端 JavaScript 包大小
4. 优化图片和静态资源
5. 实现适当的缓存策略

优化技术：
- 使用 Next.js Image 组件
- 实现动态导入和代码分割
- 优化 Server Components 使用
- 使用 ISR/SSG 适当缓存页面
- 配置 CDN 和边缘缓存

分析工具：
- npm run analyze  # 分析包大小
- npm run build    # 查看构建输出

请优化：[具体性能问题]
```

### 7. 安全加固 Agent

```markdown
你是一个安全专家，负责提升项目的安全性。

安全要求：
1. 永远不在代码中硬编码敏感信息
2. 所有用户输入必须验证和清理
3. 实现适当的速率限制
4. 使用 HTTPS 和安全的 Cookie 设置
5. 实现 CSRF 保护
6. 防止 SQL 注入和 XSS 攻击

敏感配置：
- API 密钥通过环境变量管理
- 使用 .env.local 存储本地配置
- 生产环境使用安全的密钥管理服务
- 定期轮换密钥和令牌

安全检查清单：
□ 输入验证
□ 输出编码
□ 认证和授权
□ 会话管理
□ 错误处理（不泄露敏感信息）
□ 日志记录（不记录敏感数据）

请加固：[具体安全需求]
```

## 四、开发工作流程

### 1. 新功能开发流程
```bash
# 1. 创建功能分支
git checkout -b feature/your-feature

# 2. 开发功能
# - 编写代码
# - 添加类型定义
# - 更新国际化文件

# 3. 测试
npm run lint          # 代码检查
npm run build        # 构建测试
npm run test         # 运行测试

# 4. 本地验证
npm run dev          # 启动开发服务器
# 访问 http://localhost:3000 测试功能

# 5. 提交代码（不自动推送）
git add .
git commit -m "feat: your feature description"
```

### 2. 数据库变更流程
```bash
# 1. 修改 schema
# 编辑 /src/db/schema.ts

# 2. 生成迁移
npm run db:generate

# 3. 执行迁移
npm run db:migrate

# 4. 验证变更
npm run db:studio
```

### 3. AI 提供商集成流程
```bash
# 1. 创建提供商目录
mkdir -p src/aisdk/new-provider

# 2. 实现接口
# - 创建 index.ts
# - 实现生成器函数
# - 添加类型定义

# 3. 集成到服务层
# 更新 /src/services/ai/

# 4. 更新 UI
# 修改 /src/components/blocks/ai-generator/

# 5. 添加环境变量
# 更新 .env.example

# 6. 测试集成
npm run test:integration
```

## 五、常见问题与解决方案

### Q1: 如何添加新的 AI 模型？
1. 在对应的提供商目录下更新模型列表
2. 更新 UI 组件中的模型选择器
3. 测试新模型的兼容性

### Q2: 如何实现新的生成类型？
1. 在 AI Generator 组件中添加新类型
2. 实现对应的生成逻辑
3. 更新 API 路由处理
4. 添加必要的 UI 控件

### Q3: 如何优化生成速度？
1. 使用流式响应 (SSE)
2. 实现结果缓存
3. 优化提示词
4. 使用更快的模型

### Q4: 如何处理 API 限流？
1. 实现请求队列
2. 添加重试机制
3. 使用多个 API 密钥轮询
4. 显示用户友好的错误信息

## 六、部署注意事项

### Vercel 部署
```bash
# 环境变量设置
# 在 Vercel Dashboard 设置所有必需的环境变量

# 构建命令
npm run build

# 输出目录
.next
```

### Docker 部署
```bash
# 构建镜像
npm run docker:build

# 运行容器
docker run -p 3000:3000 --env-file .env.production shipany-template-one
```

### Cloudflare Pages 部署
```bash
# 切换到 cloudflare 分支
git checkout cloudflare

# 配置 wrangler.toml
cp wrangler.toml.example wrangler.toml

# 部署
npm run cf:deploy
```

## 七、性能指标

### 目标指标
- **首屏加载**: < 2s
- **交互时间**: < 3s
- **Lighthouse 分数**: > 90
- **包大小**: < 500KB (首次加载)

### 监控工具
- Vercel Analytics
- Google Analytics
- OpenPanel
- Plausible

## 八、维护指南

### 日常维护
1. 定期更新依赖包
2. 监控错误日志
3. 检查 API 使用量
4. 备份数据库
5. 轮换 API 密钥

### 版本更新
1. 遵循语义化版本
2. 更新 CHANGELOG
3. 测试向后兼容性
4. 逐步迁移破坏性变更

---

*文档更新日期: 2025-08-15*
*版本: 1.0.0*

## 附录：快速命令参考

```bash
# 开发
npm run dev              # 启动开发服务器
npm run build           # 构建生产版本
npm run lint            # 代码检查

# 数据库
npm run db:generate     # 生成迁移
npm run db:migrate      # 执行迁移
npm run db:studio       # 数据库管理界面
npm run db:push        # 推送 schema

# 测试
npm run test           # 运行测试
npm run test:integration # 集成测试

# 分析
npm run analyze        # 包大小分析
```