# AI Universal Generator - 会员权益体系设计方案

## 一、会员等级体系设计

### 1.1 会员等级划分

| 等级 | 月费 | 年费(优惠) | 定位 |
|------|------|------------|------|
| **Free** | $0 | $0 | 体验用户 |
| **Basic** | $9 | $90 (17% off) | 个人用户 |
| **Pro** | $29 | $290 (17% off) | 专业创作者 |
| **Enterprise** | $99 | $990 (17% off) | 企业/团队 |

### 1.2 核心权益对比表

#### 🎯 AI 模型访问权限

| 功能 | Free | Basic | Pro | Enterprise |
|------|------|-------|-----|------------|
| **文本生成** |  |  |  |  |
| GPT-3.5 | ✅ 10次/天 | ✅ 100次/月 | ✅ 无限 | ✅ 无限 |
| GPT-4 | ❌ | ✅ 20次/月 | ✅ 200次/月 | ✅ 无限 |
| GPT-4o | ❌ | ❌ | ✅ 50次/月 | ✅ 无限 |
| Claude 3.5 | ❌ | ❌ | ✅ 100次/月 | ✅ 无限 |
| DeepSeek R1 | ❌ | ✅ 10次/月 | ✅ 100次/月 | ✅ 无限 |
| **图像生成** |  |  |  |  |
| DALL-E 2 | ❌ | ✅ 10张/月 | ✅ 50张/月 | ✅ 无限 |
| DALL-E 3 | ❌ | ❌ | ✅ 20张/月 | ✅ 无限 |
| Midjourney | ❌ | ❌ | ✅ 30张/月 | ✅ 无限 |
| FLUX | ❌ | ✅ 5张/月 | ✅ 50张/月 | ✅ 无限 |
| **视频生成** |  |  |  |  |
| 基础视频 | ❌ | ❌ | ✅ 5个/月 | ✅ 50个/月 |
| 高清视频 | ❌ | ❌ | ❌ | ✅ 20个/月 |

#### 💎 独特功能权益

| 功能 | Free | Basic | Pro | Enterprise |
|------|------|-------|-----|------------|
| **积分系统** |  |  |  |  |
| 注册赠送 | 10 | 100 | 500 | 2000 |
| 月度赠送 | 0 | 100 | 500 | 2000 |
| 积分有效期 | 7天 | 30天 | 90天 | 永久 |
| **生成速度** |  |  |  |  |
| 响应优先级 | 低 | 标准 | 高 | 最高 |
| 并发请求数 | 1 | 2 | 5 | 10 |
| 队列等待 | 可能 | 少量 | 优先 | 无需等待 |
| **高级功能** |  |  |  |  |
| API 访问 | ❌ | ❌ | ✅ 限速 | ✅ 无限 |
| 批量生成 | ❌ | ❌ | ✅ 10个 | ✅ 100个 |
| 自定义模板 | ❌ | 3个 | 20个 | 无限 |
| 历史记录 | 7天 | 30天 | 永久 | 永久 |
| 导出功能 | ❌ | ✅ | ✅ | ✅ |
| **协作功能** |  |  |  |  |
| 团队席位 | - | - | - | 5个 |
| 共享工作区 | ❌ | ❌ | ❌ | ✅ |
| 管理面板 | ❌ | ❌ | ❌ | ✅ |
| 使用统计 | ❌ | 基础 | 详细 | 完整分析 |
| **支持服务** |  |  |  |  |
| 社区支持 | ✅ | ✅ | ✅ | ✅ |
| Email支持 | ❌ | ✅ 48h | ✅ 24h | ✅ 2h |
| 优先支持 | ❌ | ❌ | ✅ | ✅ |
| 专属客服 | ❌ | ❌ | ❌ | ✅ |
| 定制培训 | ❌ | ❌ | ❌ | ✅ |
| **其他权益** |  |  |  |  |
| 去除水印 | ❌ | ✅ | ✅ | ✅ |
| 商用授权 | ❌ | ❌ | ✅ | ✅ |
| 白标功能 | ❌ | ❌ | ❌ | ✅ |
| SLA保证 | ❌ | ❌ | 99% | 99.9% |

## 二、技术实现方案

### 2.1 数据库改造

```sql
-- 1. 激活已有的 subscriptions 表
-- (表结构已存在于 src/db/subscriptions-schema.ts)

-- 2. 在 users 表添加订阅相关字段
ALTER TABLE users ADD COLUMN subscription_id INTEGER REFERENCES subscriptions(id);
ALTER TABLE users ADD COLUMN subscription_tier VARCHAR(20) DEFAULT 'free';
ALTER TABLE users ADD COLUMN subscription_expires_at TIMESTAMP;

-- 3. 创建功能权限映射表
CREATE TABLE feature_permissions (
  id SERIAL PRIMARY KEY,
  tier VARCHAR(20) NOT NULL, -- free, basic, pro, enterprise
  feature_key VARCHAR(100) NOT NULL, -- 功能标识
  allowed BOOLEAN DEFAULT true,
  daily_limit INTEGER, -- 每日限制
  monthly_limit INTEGER, -- 每月限制
  config JSONB, -- 其他配置
  UNIQUE(tier, feature_key)
);
```

### 2.2 权限检查中间件

```typescript
// src/middleware/subscription.ts
export async function checkSubscriptionAccess(
  userUuid: string,
  feature: string,
  model?: string
) {
  // 1. 获取用户订阅信息
  const subscription = await getUserSubscription(userUuid);
  
  // 2. 检查订阅是否有效
  if (!subscription || subscription.status !== 'active') {
    return { allowed: false, reason: 'No active subscription' };
  }
  
  // 3. 检查功能权限
  const permission = await getFeaturePermission(subscription.tier, feature);
  
  // 4. 检查使用限制
  if (permission.monthly_limit) {
    const usage = await getMonthlyUsage(userUuid, feature);
    if (usage >= permission.monthly_limit) {
      return { 
        allowed: false, 
        reason: `Monthly limit reached (${usage}/${permission.monthly_limit})` 
      };
    }
  }
  
  // 5. 检查模型访问权限
  if (model && !permission.allowed_models?.includes(model)) {
    return { 
      allowed: false, 
      reason: `Model ${model} not available in your plan` 
    };
  }
  
  return { allowed: true };
}
```

### 2.3 API 路由改造示例

```typescript
// src/app/api/demo/gen-text/route.ts
export async function POST(req: Request) {
  const session = await auth();
  
  // 1. 认证检查
  if (!session?.user?.email) {
    return respErr("Please login first");
  }
  
  // 2. 获取用户信息
  const user = await getUserWithSubscription(session.user.email);
  
  // 3. 订阅权限检查
  const accessCheck = await checkSubscriptionAccess(
    user.uuid,
    'text_generation',
    model
  );
  
  if (!accessCheck.allowed) {
    // 根据用户等级返回不同提示
    if (user.subscription_tier === 'free') {
      return respErr(
        "This feature requires a paid subscription. Upgrade to Basic plan for just $9/month!",
        { upgradeUrl: '/pricing' }
      );
    }
    return respErr(accessCheck.reason);
  }
  
  // 4. 执行生成...
  // 5. 记录使用情况
  await recordUsage(user.uuid, 'text_generation', model);
}
```

## 三、差异化功能实现

### 3.1 速度优先级队列

```typescript
// 根据用户等级分配不同优先级
const PRIORITY_LEVELS = {
  free: 1,
  basic: 5,
  pro: 10,
  enterprise: 20
};

// 使用 Redis 实现优先级队列
async function addToQueue(task: GenerationTask) {
  const priority = PRIORITY_LEVELS[task.userTier];
  await redis.zadd('generation_queue', priority, JSON.stringify(task));
}
```

### 3.2 并发限制

```typescript
// 不同等级的并发限制
const CONCURRENT_LIMITS = {
  free: 1,
  basic: 2,
  pro: 5,
  enterprise: 10
};

// 使用 Redis 实现并发控制
async function checkConcurrency(userUuid: string, tier: string) {
  const current = await redis.get(`concurrent:${userUuid}`);
  const limit = CONCURRENT_LIMITS[tier];
  
  if (current >= limit) {
    throw new Error(`Concurrent limit reached (${current}/${limit})`);
  }
  
  await redis.incr(`concurrent:${userUuid}`);
  // 设置过期时间防止死锁
  await redis.expire(`concurrent:${userUuid}`, 60);
}
```

### 3.3 功能开关

```typescript
// 基于订阅等级的功能开关
const FEATURE_FLAGS = {
  free: {
    watermark: true,
    export: false,
    api_access: false,
    batch_generation: false,
    custom_templates: false,
    advanced_models: false,
  },
  basic: {
    watermark: false,
    export: true,
    api_access: false,
    batch_generation: false,
    custom_templates: true,
    advanced_models: ['gpt-4', 'dall-e-2'],
  },
  pro: {
    watermark: false,
    export: true,
    api_access: true,
    batch_generation: true,
    custom_templates: true,
    advanced_models: ['gpt-4', 'gpt-4o', 'dall-e-3', 'claude-3.5'],
  },
  enterprise: {
    watermark: false,
    export: true,
    api_access: true,
    batch_generation: true,
    custom_templates: true,
    advanced_models: 'all',
    white_label: true,
    custom_domain: true,
  }
};
```

## 四、UI/UX 差异化

### 4.1 会员标识

```tsx
// 用户界面显示会员等级
<Badge variant={getUserBadgeVariant(user.subscription_tier)}>
  {user.subscription_tier === 'enterprise' && <Crown className="w-3 h-3 mr-1" />}
  {user.subscription_tier === 'pro' && <Star className="w-3 h-3 mr-1" />}
  {user.subscription_tier === 'basic' && <Zap className="w-3 h-3 mr-1" />}
  {user.subscription_tier.toUpperCase()}
</Badge>
```

### 4.2 功能锁定提示

```tsx
// 对未解锁功能显示升级提示
{!canUseFeature('advanced_models') && (
  <div className="relative">
    <div className="absolute inset-0 bg-black/60 flex items-center justify-center rounded-lg">
      <div className="text-center text-white p-4">
        <Lock className="w-8 h-8 mx-auto mb-2" />
        <p className="font-semibold">Pro Feature</p>
        <p className="text-sm">Upgrade to Pro to unlock</p>
        <Button size="sm" className="mt-2">
          Upgrade Now
        </Button>
      </div>
    </div>
    {/* 显示模糊的功能预览 */}
    <div className="filter blur-sm pointer-events-none">
      {/* 功能内容 */}
    </div>
  </div>
)}
```

### 4.3 使用量仪表板

```tsx
// 显示当前使用量和限制
<Card>
  <CardHeader>
    <CardTitle>Usage This Month</CardTitle>
  </CardHeader>
  <CardContent>
    <div className="space-y-4">
      {/* 文本生成使用量 */}
      <div>
        <div className="flex justify-between text-sm mb-1">
          <span>Text Generation</span>
          <span>{usage.text}/{limits.text || '∞'}</span>
        </div>
        <Progress value={(usage.text / limits.text) * 100} />
      </div>
      
      {/* 图像生成使用量 */}
      <div>
        <div className="flex justify-between text-sm mb-1">
          <span>Image Generation</span>
          <span>{usage.image}/{limits.image || '∞'}</span>
        </div>
        <Progress value={(usage.image / limits.image) * 100} />
      </div>
      
      {/* 视频生成使用量 */}
      {user.tier !== 'free' && user.tier !== 'basic' && (
        <div>
          <div className="flex justify-between text-sm mb-1">
            <span>Video Generation</span>
            <span>{usage.video}/{limits.video || '∞'}</span>
          </div>
          <Progress value={(usage.video / limits.video) * 100} />
        </div>
      )}
    </div>
  </CardContent>
</Card>
```

## 五、实施计划

### 第一阶段：基础架构（1周）
1. ✅ 激活 subscriptions 表
2. ✅ 实现订阅服务层
3. ✅ 添加权限检查中间件
4. ✅ 更新用户模型

### 第二阶段：功能差异化（2周）
1. ✅ 实现模型访问限制
2. ✅ 添加使用量追踪
3. ✅ 实现优先级队列
4. ✅ 添加并发控制

### 第三阶段：UI/UX 优化（1周）
1. ✅ 更新定价页面
2. ✅ 添加会员标识
3. ✅ 实现功能锁定提示
4. ✅ 创建使用量仪表板

### 第四阶段：高级功能（2周）
1. ✅ API 访问控制
2. ✅ 批量生成功能
3. ✅ 自定义模板系统
4. ✅ 团队协作功能

## 六、监控与优化

### 6.1 关键指标
- 转化率：免费→付费
- 升级率：Basic→Pro→Enterprise
- 留存率：各等级用户留存
- 使用率：功能使用频率
- 满意度：NPS 评分

### 6.2 A/B 测试
- 价格测试
- 功能组合测试
- 限制阈值测试
- UI 提示文案测试

## 七、竞品对比优势

| 功能 | 我们 | OpenAI Plus | Claude Pro | Midjourney |
|------|------|-------------|------------|------------|
| 月费 | $9-99 | $20 | $20 | $10-120 |
| 多模型支持 | ✅ 全部 | ❌ 仅OpenAI | ❌ 仅Claude | ❌ 仅图像 |
| API 访问 | ✅ Pro起 | ❌ | ❌ | ❌ |
| 团队协作 | ✅ Enterprise | ❌ | ❌ | ❌ |
| 白标定制 | ✅ Enterprise | ❌ | ❌ | ❌ |
| 中文优化 | ✅ | 部分 | 部分 | ❌ |

## 八、营销策略

### 8.1 免费试用
- 注册送 10 积分
- 14 天 Pro 试用
- 限时升级优惠

### 8.2 推荐奖励
- 推荐成功送积分
- 推荐付费用户得佣金
- 团队折扣

### 8.3 季节性促销
- 黑五优惠
- 新年特惠
- 学生折扣

---

**实施优先级：高**  
**预期ROI：3-6个月回收开发成本**  
**风险：需要密切监控服务器成本**

*文档版本：1.0*  
*更新日期：2025-08-15*