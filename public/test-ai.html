<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiliconFlow AI Generator Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 700px;
            width: 100%;
        }
        h1 { 
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        .status-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .status-item {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9em;
            font-weight: 600;
        }
        .status-item.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        .status-item.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        .form-group { 
            margin-bottom: 25px; 
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #495057;
            font-size: 0.95em;
        }
        select, textarea { 
            width: 100%; 
            padding: 12px 15px; 
            font-size: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s;
            font-family: inherit;
        }
        select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea { 
            min-height: 120px; 
            resize: vertical;
        }
        button { 
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        button:disabled { 
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .result { 
            margin-top: 30px; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 10px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        .result.error { 
            background: #fff5f5;
            border-left-color: #dc3545;
            color: #721c24;
        }
        .result.success { 
            background: #f0fff4;
            border-left-color: #28a745;
            color: #155724;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tip {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #004085;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ SiliconFlow AI Test</h1>
        <p class="subtitle">Test Image, Video, and Text Generation</p>
        
        <div class="status-bar">
            <div class="status-item success">
                ‚úÖ SiliconFlow Ready
            </div>
            <div class="status-item success">
                ‚úÖ OpenRouter Working
            </div>
        </div>

        <div class="tip">
            üí° <strong>SiliconFlow Integration:</strong> Real image and video generation is now available!
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button onclick="testSiliconFlowImage()" style="flex: 1; background: linear-gradient(135deg, #FF6B6B, #4ECDC4);">
                üé® Test Image
            </button>
            <button onclick="testSiliconFlowVideo()" style="flex: 1; background: linear-gradient(135deg, #A8E6CF, #7FD8BE);">
                üé¨ Test Video
            </button>
            <button onclick="testOpenRouterText()" style="flex: 1;">
                üí¨ Test Text
            </button>
        </div>

        <form id="testForm" style="display: none;">
            <div class="form-group">
                <label for="provider">AI Provider</label>
                <select id="provider" name="provider">
                    <option value="openrouter" selected>üü¢ OpenRouter (Recommended)</option>
                    <option value="openai">üî¥ OpenAI (Requires Credits)</option>
                    <option value="deepseek">DeepSeek</option>
                    <option value="siliconflow">SiliconFlow</option>
                </select>
            </div>

            <div class="form-group">
                <label for="model">Model</label>
                <select id="model" name="model">
                    <option value="meta-llama/llama-3.3-70b-instruct">Llama 3.3 70B Instruct</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prompt">Your Prompt</label>
                <textarea id="prompt" name="prompt" placeholder="Enter your creative prompt here...">Write a haiku about coding in JavaScript</textarea>
            </div>

            <button type="submit" id="submitBtn">
                Generate AI Content
            </button>
        </form>

        <div id="result"></div>
    </div>

    <script>
        async function testSiliconFlowImage() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Generating image with SiliconFlow FLUX.1...';
            
            try {
                const response = await fetch('/api/demo/gen-image-siliconflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: 'A magical forest with glowing mushrooms',
                        provider: 'siliconflow',
                        model: 'black-forest-labs/FLUX.1-schnell'
                    })
                });
                
                console.log('Response status:', response.status);
                const text = await response.text();
                console.log('Raw response:', text);
                
                const data = JSON.parse(text);
                
                if (data.code === 0 && data.data?.images?.[0]) {
                    resultDiv.className = 'result success';
                    const img = data.data.images[0];
                    resultDiv.innerHTML = `<strong>‚úÖ Image Generated!</strong>
Model: ${img.model}
Provider: ${img.provider}

<img src="${img.url}" style="max-width: 100%; margin-top: 10px; border-radius: 8px;" />`;
                } else {
                    throw new Error(data.error || 'Generation failed');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong>\n${error.message}`;
            }
        }

        async function testSiliconFlowVideo() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Testing video generation...';
            
            try {
                const response = await fetch('/api/demo/gen-video-siliconflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: 'A spaceship flying through nebula',
                        provider: 'siliconflow',
                        model: 'Pro/CogVideoX-5B-OpenSource'
                    })
                });
                
                console.log('Response status:', response.status);
                const text = await response.text();
                console.log('Raw response:', text);
                
                const data = JSON.parse(text);
                
                if (data.code === 0 && data.data) {
                    const video = data.data;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ Video Generation ${video.status === 'demo' ? '(Demo Mode)' : 'Started'}!</strong>
Model: ${video.model}
Provider: ${video.provider}
Status: ${video.status}
${video.credits_required ? `Credits Required: ${video.credits_required}` : ''}
${video.message ? `\nMessage: ${video.message}` : ''}

${video.preview_url ? `<img src="${video.preview_url}" style="max-width: 400px; margin-top: 10px; border-radius: 8px;" />` : ''}`;
                } else {
                    throw new Error(data.error || 'Generation failed');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong>\n${error.message}`;
            }
        }

        async function testOpenRouterText() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = '‚è≥ Generating text with OpenRouter...';
            
            try {
                const response = await fetch('/api/demo/gen-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: 'Write a haiku about artificial intelligence',
                        provider: 'openrouter',
                        model: 'meta-llama/llama-3.3-70b-instruct'
                    })
                });
                
                console.log('Response status:', response.status);
                const text = await response.text();
                console.log('Raw response:', text);
                
                const data = JSON.parse(text);
                
                if (data.code === 0 && data.data?.text) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<strong>‚úÖ Text Generated!</strong>
Model: meta-llama/llama-3.3-70b-instruct
Provider: OpenRouter

${data.data.text}`;
                } else {
                    throw new Error(data.error || 'Generation failed');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong>\n${error.message}`;
            }
        }

        const providers = {
            openrouter: [
                { value: "meta-llama/llama-3.3-70b-instruct", text: "Llama 3.3 70B Instruct" },
                { value: "deepseek/deepseek-r1", text: "DeepSeek R1 (Reasoning)" }
            ],
            openai: [
                { value: "gpt-4o", text: "GPT-4o (Latest)" },
                { value: "gpt-4o-mini", text: "GPT-4o Mini (Fast)" },
                { value: "gpt-3.5-turbo", text: "GPT-3.5 Turbo" }
            ],
            deepseek: [
                { value: "deepseek-chat", text: "DeepSeek Chat" },
                { value: "deepseek-r1", text: "DeepSeek R1" }
            ],
            siliconflow: [
                { value: "deepseek-ai/DeepSeek-R1", text: "DeepSeek R1 (via SF)" },
                { value: "Qwen/Qwen2.5-72B-Instruct", text: "Qwen 2.5 72B" }
            ]
        };

        const providerSelect = document.getElementById('provider');
        const modelSelect = document.getElementById('model');
        
        providerSelect.addEventListener('change', () => {
            const provider = providerSelect.value;
            const models = providers[provider] || [];
            
            modelSelect.innerHTML = '';
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.value;
                option.textContent = model.text;
                modelSelect.appendChild(option);
            });
        });

        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('result');
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> Generating...';
            resultDiv.innerHTML = '';
            
            const formData = {
                provider: document.getElementById('provider').value,
                model: document.getElementById('model').value,
                prompt: document.getElementById('prompt').value
            };
            
            console.log('Sending request:', formData);
            
            try {
                const response = await fetch('/api/demo/gen-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                console.log('Response:', data);
                
                if (response.ok && data.code === 0) {
                    resultDiv.className = 'result success';
                    const text = data.data?.text || 'No text generated';
                    resultDiv.innerHTML = `<strong>‚ú® Generated Content:</strong>\n\n${text}`;
                    
                    if (data.data?.reasoning) {
                        resultDiv.innerHTML += `\n\n<strong>üß† Reasoning Process:</strong>\n${data.data.reasoning}`;
                    }
                } else {
                    resultDiv.className = 'result error';
                    const errorMsg = data.error || data.message || 'Unknown error occurred';
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong>\n\n${errorMsg}`;
                    
                    if (errorMsg.includes('quota')) {
                        resultDiv.innerHTML += '\n\nüí° Suggestion: Try using OpenRouter instead!';
                    }
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå Network Error:</strong>\n\n${error.message}\n\nMake sure the development server is running on port 3001.`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Generate AI Content';
            }
        });

        // Auto-select OpenRouter on load
        window.addEventListener('load', () => {
            providerSelect.value = 'openrouter';
            providerSelect.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>